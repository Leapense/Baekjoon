<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Polly Nomials â€“ ìµœì†Œ í‚¤ì…ë ¥ ì‹œê°í™”</title>
    <style>
        :root {
            --bg: #0b1020;
            --panel: #111833;
            --muted: #8aa0c2;
            --fg: #e8edff;
            --brand: #6ea8fe;
            --accent: #b794f4;
            --ok: #7ee787;
            --warn: #ffcc66;
            --danger: #ff7b72;
            --chip: #1a2246;
            --chip-done: #24356f;
            --chip-active: #2f4ab0;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #0b1020, #0c1428);
            color: var(--fg);
            font: 16px/1.5 system-ui, Segoe UI, Roboto, Apple SD Gothic Neo, \B3CB\C6C0, Malgun Gothic, sans-serif
        }

        a {
            color: var(--brand)
        }

        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 28px
        }

        h1 {
            font-size: 26px;
            margin: 0 0 8px
        }

        .sub {
            color: var(--muted);
            margin-bottom: 22px
        }

        .grid {
            display: grid;
            gap: 16px
        }

        @media(min-width:960px) {
            .grid {
                grid-template-columns: 1.1fr 1fr
            }
        }

        .card {
            background: var(--panel);
            border: 1px solid #1e274b;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 6px 24px #00000040
        }

        .card h2 {
            font-size: 18px;
            margin: 0 0 10px
        }

        .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        label {
            display: block;
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 6px
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid #2a3563;
            background: #0c1531;
            color: var(--fg)
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px
        }

        button {
            border: 1px solid #2a3563;
            background: #142253;
            color: var(--fg);
            padding: 9px 12px;
            border-radius: 12px;
            cursor: pointer
        }

        button:hover {
            background: #1a2b6a
        }

        button.primary {
            background: #2b54c9;
            border-color: #2b54c9
        }

        button.primary:hover {
            background: #3563ea
        }

        button.ghost {
            background: #0c1531
        }

        .muted {
            color: var(--muted)
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace
        }

        .flex {
            display: flex;
            gap: 14px;
            align-items: center;
            flex-wrap: wrap
        }

        .pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid #2a3563;
            background: var(--chip);
            min-width: 36px
        }

        .pill.done {
            background: var(--chip-done)
        }

        .pill.active {
            background: var(--chip-active);
            border-color: var(--brand)
        }

        .scroller {
            display: flex;
            gap: 8px;
            overflow: auto;
            padding-bottom: 6px
        }

        .kpi {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
            margin-top: 8px
        }

        .kpi .card-mini {
            background: #0c1531;
            border: 1px solid #2a3563;
            border-radius: 12px;
            padding: 10px
        }

        .card-mini h3 {
            margin: 0 0 4px;
            font-size: 12px;
            color: var(--muted)
        }

        .card-mini .v {
            font-size: 18px
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px
        }

        .table th,
        .table td {
            border-bottom: 1px solid #223064;
            padding: 8px 6px;
            text-align: left
        }

        .table th {
            color: var(--muted);
            font-weight: 600
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            background: #203067;
            border: 1px solid #2a3563;
            color: #cfe3ff;
            font-size: 12px
        }

        .hint {
            font-size: 13px;
            color: var(--muted)
        }

        .callout {
            border-left: 3px solid var(--brand);
            padding: 10px 12px;
            background: #0f1a3b;
            border-radius: 8px
        }

        .sequence {
            white-space: nowrap
        }

        .foot {
            margin-top: 22px;
            color: var(--muted);
            font-size: 13px
        }

        .center {
            display: flex;
            align-items: center;
            justify-content: center
        }

        .sep {
            height: 1px;
            background: #213064;
            margin: 12px 0
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1>ğŸ¦ Polly Nomials â€” ìµœì†Œ í‚¤ì…ë ¥ ì‹œê°í™”</h1>
        <div class="sub">í˜¸ë„ˆ(Horner) í˜•ì‹ìœ¼ë¡œ <span class="mono">x</span>ë¶€í„° ì‹œì‘í•´ <span class="mono">+ a<sub>i</sub></span>ì™€
            <span class="mono">Ã— x</span>ë¥¼ ë²ˆê°ˆì•„ ëˆ„ë¥´ë©° ê°’ì„ êµ¬í•˜ê³ , ë™ì‹œì— ìµœì†Œ í‚¤ ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</div>

        <div class="grid">
            <div class="card">
                <h2>ì…ë ¥</h2>
                <div class="row">
                    <div style="flex:1 1 140px;min-width:140px">
                        <label>ì°¨ìˆ˜ n (1~100)</label>
                        <input id="deg" type="number" value="3" min="1" max="100" />
                    </div>
                    <div style="flex:2 1 360px;min-width:240px">
                        <label>ê³„ìˆ˜ a<sub>n</sub> â€¦ a<sub>0</sub> (ê³µë°± êµ¬ë¶„, ëª¨ë‹‰: a<sub>n</sub>=1)</label>
                        <input id="coeffs" type="text" value="1 0 1 11" />
                    </div>
                    <div style="flex:1 1 160px;min-width:140px">
                        <label>x ê°’</label>
                        <div class="flex">
                            <label><input type="radio" name="xval" value="1" checked> <span class="mono">x =
                                    1</span></label>
                            <label><input type="radio" name="xval" value="-1"> <span class="mono">x = -1</span></label>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button class="primary" id="run">ì‹œê°í™” ì‹œì‘</button>
                    <button class="ghost" id="sample1">ìƒ˜í”Œ 1 ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button class="ghost" id="sample2">ìƒ˜í”Œ 2 ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button class="ghost" id="reset">ì´ˆê¸°í™”</button>
                </div>
                <div class="hint">í˜•ì‹: <span class="mono">n a<sub>n</sub> a<sub>n-1</sub> â€¦ a<sub>0</sub> xâˆˆ{Â±1}</span>.
                    ì‹œê°í™”ëŠ” <strong>ìµœì†Œ í‚¤</strong> ì…ë ¥ ìˆœì„œ(<span class="mono">x</span> â†’ <span class="mono">+
                        a<sub>i</sub></span> â†’ <span class="mono">Ã— x</span>)ì— ë§ì¶° ì§„í–‰ë©ë‹ˆë‹¤.</div>
            </div>

            <div class="card">
                <h2>ìš”ì•½</h2>
                <div class="kpi">
                    <div class="card-mini">
                        <h3>ë‹¤í•­ì‹</h3>
                        <div class="v mono" id="polyStr">â€”</div>
                    </div>
                    <div class="card-mini">
                        <h3>ê°’ f(x)</h3>
                        <div class="v mono" id="polyVal">â€”</div>
                    </div>
                    <div class="card-mini">
                        <h3>ìµœì†Œ í‚¤ ìˆ˜</h3>
                        <div class="v mono" id="minCost">â€”</div>
                    </div>
                </div>
                <div class="sep"></div>
                <div class="callout hint">ê³µì‹: <span class="mono">2n + Î£<sub>i=0..n-1, a<sub>i</sub>&gt;0</sub>(1 +
                        digits(a<sub>i</sub>))</span> â€” ì‹œì‘ <span class="mono">x</span>, ê³±ì…ˆ <span
                        class="mono">(n-1)</span>íšŒ, ê° ì–‘ì˜ ê³„ìˆ˜ë§ˆë‹¤ <span class="mono">'+'</span>ì™€ ìë¦¬ìˆ˜.</div>
            </div>
        </div>

        <div class="grid" style="margin-top:16px">
            <div class="card">
                <h2>í‚¤ ì…ë ¥ ìŠ¤íŠ¸ë¦¼</h2>
                <div id="keyStream" class="scroller"></div>
                <div class="flex" style="margin-top:10px">
                    <button id="prev">âŸµ ì´ì „</button>
                    <button id="next">ë‹¤ìŒ âŸ¶</button>
                    <button id="auto">â–¶ ìë™ ì¬ìƒ</button>
                    <span class="muted">ì§„í–‰: <span id="progress">0 / 0</span></span>
                </div>
            </div>

            <div class="card">
                <h2>ë‹¨ê³„ ë¡œê·¸ (ê°’ì˜ ë³€í™”)</h2>
                <table class="table" id="stepTable">
                    <thead>
                        <tr>
                            <th>ìˆœì„œ</th>
                            <th>ì—°ì‚°</th>
                            <th class="mono">í˜„ì¬ ê°’</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="card" style="margin-top:16px">
            <h2>ë¹„ìš© ë¶„í•´</h2>
            <table class="table" id="costTable">
                <thead>
                    <tr>
                        <th>êµ¬ì„±</th>
                        <th>ì„¤ëª…</th>
                        <th>ë¹„ìš©</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="foot">â“˜ ê³„ì‚°ì€ ì„ì˜ ì •ë°€ë„(í° ì •ìˆ˜)ë¥¼ ìœ„í•´ JavaScript <span class="mono">BigInt</span>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ìë¦¬ìˆ˜ëŠ” 10ì§„ í‘œê¸° ê¸¸ì´ì…ë‹ˆë‹¤.
        </div>
    </div>

    <script>
        (function () {
            const $ = sel => document.querySelector(sel);
            const $$ = sel => Array.from(document.querySelectorAll(sel));
            const degEl = $('#deg');
            const coeffsEl = $('#coeffs');
            const keyStreamEl = $('#keyStream');
            const polyStrEl = $('#polyStr');
            const polyValEl = $('#polyVal');
            const minCostEl = $('#minCost');
            const stepTableBody = $('#stepTable tbody');
            const costTableBody = $('#costTable tbody');
            const progressEl = $('#progress');

            const btnRun = $('#run');
            const btnPrev = $('#prev');
            const btnNext = $('#next');
            const btnAuto = $('#auto');
            const btnSample1 = $('#sample1');
            const btnSample2 = $('#sample2');
            const btnReset = $('#reset');

            let state = null; // will hold built visualization data
            let autoTimer = null;

            function parseInput() {
                const n = Number(degEl.value.trim());
                if (!Number.isInteger(n) || n < 1 || n > 100) throw new Error('ì°¨ìˆ˜ nì€ 1~100 ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                const coeffStrs = coeffsEl.value.trim().split(/\s+/).filter(Boolean);
                if (coeffStrs.length !== n + 1) throw new Error(`ê³„ìˆ˜ ê°œìˆ˜ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. (ê¸°ëŒ€: ${n + 1}ê°œ, í˜„ì¬: ${coeffStrs.length}ê°œ)`);
                const a = coeffStrs.map(s => toBigIntStrict(s));
                if (a[0] !== 1n) throw new Error('ëª¨ë‹‰ ì¡°ê±´ ìœ„ë°˜: a_n = 1 ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (ë§¨ ì• ìˆ«ì)');
                const x = BigInt(document.querySelector('input[name="xval"]:checked').value);
                if (x !== 1n && x !== -1n) throw new Error('xëŠ” 1 ë˜ëŠ” -1 ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');

                // a ë°°ì—´ì„ a_n..a_0 ì—ì„œ a[n]..a[0] í˜•íƒœë¡œ ë³€í™˜
                const arr = Array(n + 1);
                for (let i = 0; i <= n; i++) { arr[n - i] = a[i]; }
                return { n, a: arr, x };
            }

            function toBigIntStrict(s) {
                if (!/^\d+$/.test(s)) throw new Error('ê³„ìˆ˜ëŠ” 0 ì´ìƒì˜ ì •ìˆ˜ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.');
                return BigInt(s);
            }

            function digits10(bi) { return bi.toString(10).length; }

            function buildPolyString(n, a) {
                // ë°˜í™˜: í…ìŠ¤íŠ¸ "x^n + a_{n-1}x^{n-1} + ... + a0" (0ë„ í‘œì‹œ, ê°€ë…ì„±ìš©)
                const parts = [];
                parts.push(n === 1 ? 'x' : `x^${n}`);
                for (let i = n - 1; i >= 1; i--) {
                    parts.push(` + ${a[i]}x${i === 1 ? '' : '^' + i}`);
                }
                parts.push(` + ${a[0]}`);
                return parts.join('');
            }

            function evalValueAndBuildSteps(n, a, x) {
                // ìµœì†Œ í‚¤ ì…ë ¥ ìˆœì„œì— ë§ì¶˜ ë‹¨ê³„: start x; for i=n-1..0: [+a_i?], [*x if i>0]
                const steps = []; // {label, val} ; label is description
                let cur = x; // ì‹œì‘: í™”ë©´ì— x
                steps.push({ label: "ì‹œì‘: x", val: cur });

                for (let i = n - 1; i >= 0; i--) {
                    if (a[i] > 0n) {
                        const before = cur;
                        cur = cur + a[i];
                        steps.push({ label: `+ a_${i} (${a[i].toString()})`, val: cur, i, kind: 'add' });
                    }
                    if (i > 0) {
                        const before = cur;
                        cur = cur * x;
                        steps.push({ label: `Ã— x (x=${x > 0n ? '+1' : '-1'})`, val: cur, i, kind: 'mul' });
                    }
                }
                // ìµœì¢…ê°’ cur
                return { value: cur, steps };
            }

            function buildKeyTokens(n, a) {
                // í† í° ë°°ì—´: {t:"x"|"+"|"digit"|"Ã—"|"=", v?:string}
                const tokens = [];
                tokens.push({ t: 'x', v: 'x' });
                for (let i = n - 1; i >= 0; i--) {
                    if (a[i] > 0n) {
                        tokens.push({ t: '+', v: '+' });
                        const s = a[i].toString();
                        for (const ch of s) tokens.push({ t: 'digit', v: ch });
                    }
                    if (i > 0) { tokens.push({ t: 'Ã—', v: 'Ã—' }); tokens.push({ t: 'x', v: 'x' }); }
                }
                tokens.push({ t: '=', v: '=' });
                return tokens;
            }

            function buildCostBreakdown(n, a) {
                const rows = [];
                rows.push({ name: 'ê¸°ë³¸', desc: `ì‹œì‘ x + ê³±ì…ˆ ${n - 1}íšŒ + '='`, cost: 2 * n });
                let extra = 0;
                for (let i = n - 1; i >= 0; i--) {
                    if (a[i] > 0n) {
                        const d = digits10(a[i]);
                        rows.push({ name: `a_${i}>0`, desc: `+ (1) + digits(${a[i]}) (${d})`, cost: 1 + d });
                        extra += 1 + d;
                    }
                }
                return { rows, total: 2 * n + extra };
            }

            function renderAll() {
                if (!state) { return; }
                // summary
                polyStrEl.textContent = state.polyStr;
                polyValEl.textContent = state.value.toString();
                minCostEl.textContent = state.tokens.length.toString();

                // key tokens
                keyStreamEl.innerHTML = '';
                state.tokens.forEach((tok, idx) => {
                    const el = document.createElement('div');
                    el.className = 'pill mono';
                    el.textContent = tok.v;
                    el.dataset.idx = idx;
                    keyStreamEl.appendChild(el);
                });
                updateTokenHighlight();

                // step table
                stepTableBody.innerHTML = '';
                state.actionSteps.forEach((st, i) => {
                    const tr = document.createElement('tr');
                    const td0 = document.createElement('td'); td0.textContent = (i + 1).toString();
                    const td1 = document.createElement('td'); td1.textContent = st.label;
                    const td2 = document.createElement('td'); td2.textContent = st.val.toString(); td2.className = 'mono';
                    tr.appendChild(td0); tr.appendChild(td1); tr.appendChild(td2);
                    stepTableBody.appendChild(tr);
                });

                // cost table
                costTableBody.innerHTML = '';
                state.cost.rows.forEach(r => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td><span class="badge">${r.name}</span></td><td>${r.desc}</td><td class="mono">${r.cost}</td>`;
                    costTableBody.appendChild(tr);
                });
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><strong>í•©ê³„</strong></td><td class="muted">ìµœì†Œ í‚¤ ìˆ˜</td><td class="mono"><strong>${state.cost.total}</strong></td>`;
                costTableBody.appendChild(tr);

                // progress
                updateProgress();
            }

            function updateTokenHighlight() {
                const pills = $$('#keyStream .pill');
                pills.forEach((el, i) => {
                    el.classList.toggle('done', i < state.cursor);
                    el.classList.toggle('active', i === state.cursor);
                });
                // autoscroll
                const active = $('#keyStream .pill.active');
                if (active) { active.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' }); }
            }

            function updateProgress() {
                progressEl.textContent = `${Math.min(state.cursor + 1, state.tokens.length)} / ${state.tokens.length}`;
            }

            function step(delta) {
                if (!state) return;
                const next = Math.max(0, Math.min(state.cursor + delta, state.tokens.length - 1));
                state.cursor = next;
                updateTokenHighlight();
                updateProgress();
            }

            function autoplay() {
                if (!state) return;
                if (autoTimer) { clearInterval(autoTimer); autoTimer = null; btnAuto.textContent = 'â–¶ ìë™ ì¬ìƒ'; return; }
                btnAuto.textContent = 'â¸ ì¼ì‹œì •ì§€';
                autoTimer = setInterval(() => {
                    if (state.cursor >= state.tokens.length - 1) { clearInterval(autoTimer); autoTimer = null; btnAuto.textContent = 'â–¶ ìë™ ì¬ìƒ'; return; }
                    step(1);
                }, 600);
            }

            function build() {
                const { n, a, x } = parseInput();

                // build tokens & cost
                const tokens = buildKeyTokens(n, a);
                const cost = buildCostBreakdown(n, a);

                // evaluate along the same order as tokens
                const { value, steps } = evalValueAndBuildSteps(n, a, x);

                // build poly string for UX (explicit 0 í¬í•¨)
                const polyStr = buildPolyString(n, a);

                state = {
                    n, a, x,
                    tokens,
                    cost,
                    value,
                    polyStr,
                    actionSteps: steps,
                    cursor: 0
                };
            }

            function run() {
                try {
                    build();
                    renderAll();
                } catch (err) {
                    alert(err.message || String(err));
                }
            }

            // events
            btnRun.addEventListener('click', run);
            btnPrev.addEventListener('click', () => step(-1));
            btnNext.addEventListener('click', () => step(1));
            btnAuto.addEventListener('click', autoplay);
            btnReset.addEventListener('click', () => { state = null; keyStreamEl.innerHTML = ''; stepTableBody.innerHTML = ''; costTableBody.innerHTML = ''; polyStrEl.textContent = 'â€”'; polyValEl.textContent = 'â€”'; minCostEl.textContent = 'â€”'; progressEl.textContent = '0 / 0'; if (autoTimer) { clearInterval(autoTimer); autoTimer = null; btnAuto.textContent = 'â–¶ ìë™ ì¬ìƒ'; } });
            btnSample1.addEventListener('click', () => { degEl.value = 3; coeffsEl.value = '1 0 1 11'; $$('input[name="xval"]').forEach(r => r.checked = (r.value === '1')); run(); });
            btnSample2.addEventListener('click', () => { degEl.value = 3; coeffsEl.value = '1 0 2 11'; $$('input[name="xval"]').forEach(r => r.checked = (r.value === '-1')); run(); });

            // ì´ˆê¸° ë Œë”: ìƒ˜í”Œ 1ë¡œ
            btnSample1.click();
        })();
    </script>
</body>

</html>